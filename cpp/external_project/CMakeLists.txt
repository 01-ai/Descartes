CMAKE_MINIMUM_REQUIRED(VERSION 3.10 FATAL_ERROR)
INCLUDE(ExternalProject)
INCLUDE(GNUInstallDirs)

SET(CMAKE_WARN_DEPRECATED OFF CACHE INTERNAL "")

SET(DEPS_DOWNLOAD_DIR ${CMAKE_CURRENT_LIST_DIR}/download)
SET(DEPS_INSTALL_DIR  ${CMAKE_CURRENT_LIST_DIR}/install)
SET(DEPS_PRE_DIR ${CMAKE_CURRENT_LIST_DIR}/cmake)

CONFIGURE_FILE(external.pre ${DEPS_DOWNLOAD_DIR}/CMakeLists.txt @ONLY)

SET(DEPS_DOWNLOAD_WORKING_DIR ${DEPS_DOWNLOAD_DIR}/build)
FILE(MAKE_DIRECTORY ${DEPS_DOWNLOAD_WORKING_DIR})

EXECUTE_PROCESS(COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}" ..
    RESULT_VARIABLE RESULT
    WORKING_DIRECTORY ${DEPS_DOWNLOAD_WORKING_DIR})
IF(RESULT)
    MESSAGE(FATAL_ERROR "CMake step for download stage failed: ${RESULT}")
ENDIF()

EXECUTE_PROCESS(COMMAND ${CMAKE_COMMAND} --build .
    RESULT_VARIABLE RESULT
    WORKING_DIRECTORY ${DEPS_DOWNLOAD_WORKING_DIR})
IF(RESULT)
    MESSAGE(FATAL_ERROR "Build step for download stage failed: ${RESULT}")
ENDIF()
